module.exports=[32735,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(71478),e=a.i(50944),f=a.i(33597);let g=(0,a.i(60137).default)("arrow-right-left",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);var h=a.i(66384),i=a.i(4416),j=a.i(96221);function k(){let{isAuthenticated:a,isLoading:k}=(0,d.useAuth)(),l=(0,e.useRouter)(),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(null);(0,c.useEffect)(()=>{k||a||l.push("/")},[k,a,l]),(0,c.useEffect)(()=>{if(C){let a=setTimeout(()=>D(null),5e3);return()=>clearTimeout(a)}},[C]);let E=async(a,b,c)=>{if(console.log(`[FetchAccess] Starting for user: ${a}`),!a)return void b([]);c(!0);try{let c=sessionStorage.getItem("sp_auth");if(!c){console.error("[FetchAccess] No auth found in session storage"),D({type:"error",message:"Session expired. Please log in again."}),l.push("/");return}let{url:d,username:e,password:f}=JSON.parse(c);if(!d||!e||!f)return void console.error("[FetchAccess] Incomplete auth credentials");let g=new AbortController,h=setTimeout(()=>g.abort(),3e4),i=await fetch("/api/workflow/launch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:d,username:e,password:f,workflowName:"GetIdentityAccess",input:{identityName:a}}),signal:g.signal}).finally(()=>clearTimeout(h));if(!i.ok)throw Error(`Server returned ${i.status} ${i.statusText}`);let j=await i.json();if(console.log("[FetchAccess] Response:",j),j.success&&j.launchResult){let a=j.launchResult["urn:ietf:params:scim:schemas:sailpoint:1.0:LaunchedWorkflow"];if(a?.output){let c=a.output.find(a=>"accessList"===a.key);if(c?.value){let a=c.value;console.log("Access list received (raw):",a),console.log("Type of accessList:",typeof a),"string"==typeof a&&(a=(a=>{if("string"!=typeof a)return a;let b=a.trim();return b.startsWith("[")&&(b=b.substring(1)),b.endsWith("]")&&(b=b.substring(0,b.length-1)),b.split(/\},\s*\{/).map(a=>{let b=a.trim();b.startsWith("{")||(b="{"+b),b.endsWith("}")||(b+="}");let c=b.substring(1,b.length-1),d={};return c.split(/,\s*(?=[a-zA-Z_]+\s*=)/).forEach(a=>{let b=a.indexOf("=");if(b>0){let c=a.substring(0,b).trim(),e=a.substring(b+1).trim();d[c]=e}}),d})})(a),console.log("Parsed access list:",a),console.log("Parsed first item:",JSON.stringify(a[0])));let d=Array.isArray(a)?a.filter(a=>{let b=a.type?a.type.toLowerCase():"";return!b.includes("account")&&!b.includes("link")&&!b.includes("application")}):[];b(d)}else console.warn("No accessList found in workflow output:",a.output),b([])}else console.warn("No workflow output found:",j.launchResult),b([])}else console.warn("Workflow did not return success:",j),b([])}catch(c){"AbortError"===c.name?(console.error("Fetch access timed out"),D({type:"error",message:"Timeout: Unable to fetch access for "+a})):console.error("Failed to fetch access",c),b([])}finally{c(!1)}};(0,c.useEffect)(()=>{m?.userName?E(m.userName,r,x):r([])},[m]),(0,c.useEffect)(()=>{o?.userName?E(o.userName,t,z):t([])},[o]),(0,c.useEffect)(()=>{if(!m||!o)return void v(null);let a=a=>`${a.type}::${a.value}`;v({uniqueToSource:q.filter(b=>!s.some(c=>a(b)===a(c))),uniqueToTarget:s.filter(b=>!q.some(c=>a(c)===a(b)))})},[q,s,m,o]);let F=a=>{let c="bg-slate-700 text-slate-300";return a.includes("Assigned")?c="bg-purple-500/10 text-purple-400 border border-purple-500/20":a.includes("Detected")?c="bg-indigo-500/10 text-indigo-400 border border-indigo-500/20":a.includes("Entitlement")?c="bg-blue-500/10 text-blue-400 border border-blue-500/20":a.includes("Account")&&(c="bg-emerald-500/10 text-emerald-400 border border-emerald-500/20"),(0,b.jsx)("span",{className:`text-[10px] uppercase font-bold px-2 py-0.5 rounded-full ${c}`,children:a})},[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(!1),K=async()=>{if(o&&G){J(!0);try{let a,{url:b,username:c,password:d}=JSON.parse(sessionStorage.getItem("sp_auth")||"{}"),e=o.userName,f=(a="",G.forEach(b=>{if(b.type.includes("Role")||b.type.includes("Bundle"))a+=`
  <AccountRequest application="IIQ" op="Modify" nativeIdentity="${e}">
    <AttributeRequest name="assignedRoles" op="Add" value="${b.value}"/>
  </AccountRequest>`;else if(b.type.includes("Entitlement")){let c=b.name.split(" : ");if(c.length>=2){let d=c[0],f=c[1];a+=`
  <AccountRequest application="${d}" op="Modify" nativeIdentity="${e}">
    <AttributeRequest name="${f}" op="Add" value="${b.value}"/>
  </AccountRequest>`}}}),`<ProvisioningPlan>
${a}
  <Attributes>
    <Map>
      <entry key="identityRequestId" value=""/>
      <entry key="requester" value="${c}"/>
      <entry key="source" value="LCM"/>
    </Map>
  </Attributes>
  <Requesters>
    <Reference class="sailpoint.object.Identity" name="${c}"/>
  </Requesters>
</ProvisioningPlan>`),g=await fetch("/api/workflow/launch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:b,username:c,password:d,workflowName:"LCM Provisioning",input:[{key:"plan",value:f,type:"application/xml"},{key:"targetName",value:e},{key:"targetClass",value:"Identity"},{key:"identityName",value:e},{key:"flow",value:"AccessRequest"}]})}),h=await g.json();if(h.success){let a="Unknown",b=h.launchResult?.["urn:ietf:params:scim:schemas:sailpoint:1.0:LaunchedWorkflow"];if(b?.identityRequestId&&(a=b.identityRequestId),"Unknown"===a&&h.launchResult?.attributes){let b=h.launchResult.attributes.find(a=>"identityRequestId"===a.key);b?.value&&(a=b.value)}if("Unknown"===a&&b?.output){let c=b.output.find(a=>"identityRequestId"===a.key);c?.value&&(a=c.value)}console.log("Extracted Request ID:",a),console.log("Full response (JSON):",JSON.stringify(h.launchResult,null,2)),console.log("Attributes array:",h.launchResult?.attributes),console.log("Workflow URN data:",b),"Unknown"!==a?D({type:"success",message:`Request ID: ${a}. Access request submitted successfully.`}):D({type:"success",message:`Workflow Launched (ID: ${h.launchResult?.id}). Request ID not found.`})}else D({type:"error",message:"Error: "+h.error})}catch(a){D({type:"error",message:"Failed: "+a.message})}finally{J(!1),H(null)}}};return k||!a?null:(0,b.jsxs)("main",{className:"min-h-screen bg-[#020617] text-slate-100 flex flex-col relative overflow-hidden font-sans selection:bg-indigo-500/30",children:[(0,b.jsx)("div",{className:"absolute top-0 left-0 w-full h-[500px] bg-gradient-to-b from-indigo-950/20 to-transparent pointer-events-none"}),(0,b.jsx)("div",{className:"absolute -top-[200px] left-[20%] w-[500px] h-[500px] bg-indigo-600/10 rounded-full blur-[100px] pointer-events-none"}),(0,b.jsx)("div",{className:"absolute top-[10%] right-[20%] w-[400px] h-[400px] bg-purple-600/10 rounded-full blur-[100px] pointer-events-none"}),(0,b.jsxs)("div",{className:"max-w-7xl mx-auto w-full space-y-10 flex-1 flex flex-col p-6 z-10",children:[(0,b.jsx)("div",{className:"flex items-center justify-between border-b border-white/5 pb-6",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-4xl font-extrabold tracking-tight pb-1 bg-gradient-to-r from-white via-slate-200 to-slate-400 bg-clip-text text-transparent",children:"Access Comparator"}),(0,b.jsx)("p",{className:"text-slate-400 text-sm mt-1",children:"Analyze and synchronize identity access with precision."})]})}),C&&(0,b.jsx)("div",{className:`fixed top-24 right-4 z-[100] px-6 py-4 rounded-xl shadow-2xl border backdrop-blur-md animate-in slide-in-from-right fade-in duration-300 ${"success"===C.type?"bg-emerald-500/10 border-emerald-500/20 text-emerald-400":"bg-red-500/10 border-red-500/20 text-red-400"}`,children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:["success"===C.type?(0,b.jsx)(i.ShieldCheck,{className:"h-5 w-5"}):(0,b.jsx)(h.ShieldAlert,{className:"h-5 w-5"}),(0,b.jsx)("p",{className:"text-sm font-medium",children:C.message})]})}),(0,b.jsxs)("div",{className:"relative mb-8 bg-slate-900/40 backdrop-blur-xl border border-white/10 p-8 rounded-2xl shadow-2xl grid grid-cols-1 md:grid-cols-[1fr_auto_1fr] gap-8 items-end group hover:border-white/15 transition-all duration-500",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(f.UserSearch,{label:"Source Identity (Template)",placeholder:"Search template user...",onSelect:n,value:m?.displayName,disabled:w}),w&&(0,b.jsx)("div",{className:"absolute right-2 top-8",children:(0,b.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin text-blue-400"})})]}),(0,b.jsxs)("div",{className:"flex flex-col items-center justify-end h-full pb-1 relative",children:[m&&o&&(0,b.jsx)("div",{className:"absolute -top-14 left-1/2 -translate-x-1/2 w-48 z-20",children:(0,b.jsxs)("button",{onClick:()=>{var a,b;return a=o.userName,b=u?.uniqueToSource||[],void(a&&0!==b.length&&H(b))},disabled:!u?.uniqueToSource?.length||y||w,className:`w-full text-xs font-bold uppercase tracking-wider px-4 py-3 rounded-xl flex items-center justify-center gap-2 shadow-lg transition-all duration-300 ${u?.uniqueToSource?.length>0&&!y&&!w?"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white shadow-indigo-500/30 hover:shadow-indigo-500/50 hover:-translate-y-1":"bg-slate-800 text-slate-500 cursor-not-allowed border border-white/5"}`,children:[y||w?(0,b.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(g,{className:"h-4 w-4"}),y||w?"Processing...":u?.uniqueToSource?.length>0?"Copy Access":"Matched"]})}),(0,b.jsx)("div",{className:"h-12 w-12 flex items-center justify-center rounded-2xl bg-slate-800/50 border border-white/10 text-slate-400 shadow-inner",children:(0,b.jsx)(g,{className:"h-5 w-5 opacity-50"})})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(f.UserSearch,{label:"Target Identity (To Check)",placeholder:"Search target user...",onSelect:p,value:o?.displayName,disabled:y}),y&&(0,b.jsx)("div",{className:"absolute right-2 top-8",children:(0,b.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin text-purple-400"})})]})]}),u&&(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 flex-1 animate-in fade-in slide-in-from-bottom-4 duration-700",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsx)("div",{className:"flex items-center justify-between bg-amber-500/10 p-4 rounded-xl border border-amber-500/20",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-amber-500/20 rounded-lg text-amber-500",children:(0,b.jsx)(h.ShieldAlert,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold text-amber-200",children:"Missing Access"}),(0,b.jsxs)("p",{className:"text-xs text-amber-400/60 font-medium tracking-wide uppercase",children:[u.uniqueToSource.length," Items to Add"]})]})]})}),(0,b.jsx)("div",{className:"bg-slate-900/40 backdrop-blur-md border border-white/5 rounded-2xl overflow-hidden shadow-xl flex-1 min-h-[400px] flex flex-col",children:0===u.uniqueToSource.length?(0,b.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-500 gap-2",children:[(0,b.jsx)(i.ShieldCheck,{className:"h-10 w-10 opacity-20"}),(0,b.jsx)("span",{className:"text-sm",children:"Parties are identical"})]}):(0,b.jsx)("div",{className:"overflow-auto flex-1 p-2 custom-scrollbar",children:(0,b.jsx)("ul",{className:"space-y-2",children:u.uniqueToSource.map((a,c)=>(0,b.jsxs)("li",{className:"group p-4 rounded-xl bg-white/[0.02] hover:bg-white/[0.06] border border-white/5 hover:border-white/10 transition-all duration-200 flex flex-col gap-2",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsx)("span",{className:"text-sm text-slate-200 font-semibold leading-snug group-hover:text-amber-200 transition-colors",children:a.name}),(0,b.jsx)("div",{className:"shrink-0",children:F(a.type)})]}),(0,b.jsx)("div",{className:"text-[10px] text-slate-500 font-mono bg-black/20 p-1.5 rounded w-fit border border-white/5",children:a.value})]},c))})})})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsx)("div",{className:"flex items-center justify-between bg-emerald-500/10 p-4 rounded-xl border border-emerald-500/20",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-emerald-500/20 rounded-lg text-emerald-500",children:(0,b.jsx)(i.ShieldCheck,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold text-emerald-200",children:"Existing Access"}),(0,b.jsxs)("p",{className:"text-xs text-emerald-400/60 font-medium tracking-wide uppercase",children:[u.uniqueToTarget.length," Extra Items"]})]})]})}),(0,b.jsx)("div",{className:"bg-slate-900/40 backdrop-blur-md border border-white/5 rounded-2xl overflow-hidden shadow-xl flex-1 min-h-[400px] flex flex-col",children:0===u.uniqueToTarget.length?(0,b.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-500 gap-2",children:(0,b.jsx)("span",{className:"text-sm",children:"Target has no extra access"})}):(0,b.jsx)("div",{className:"overflow-auto flex-1 p-2 custom-scrollbar",children:(0,b.jsx)("ul",{className:"space-y-2",children:u.uniqueToTarget.map((a,c)=>(0,b.jsxs)("li",{className:"group p-4 rounded-xl bg-white/[0.02] hover:bg-white/[0.06] border border-white/5 hover:border-white/10 transition-all duration-200 flex flex-col gap-2",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsx)("span",{className:"text-sm text-slate-200 font-semibold leading-snug group-hover:text-emerald-200 transition-colors",children:a.name}),(0,b.jsx)("div",{className:"shrink-0",children:F(a.type)})]}),(0,b.jsx)("div",{className:"text-[10px] text-slate-500 font-mono bg-black/20 p-1.5 rounded w-fit border border-white/5",children:a.value})]},c))})})})]})]})]}),(0,b.jsx)("div",{className:"p-4 flex justify-center opacity-30 hover:opacity-100 transition-opacity",children:(0,b.jsx)("button",{onClick:()=>B(!A),className:"text-[10px] uppercase font-bold tracking-widest text-slate-500 hover:text-slate-300",children:A?"Hide Debug System":"Show System Status"})}),A&&(0,b.jsxs)("div",{className:"mx-auto max-w-7xl w-full p-6 border-t border-slate-800 bg-slate-950",children:[(0,b.jsx)("h3",{className:"text-sm font-bold mb-4 text-slate-500 uppercase tracking-wider",children:"Debug Data"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"bg-black/40 p-4 rounded-lg border border-slate-800 overflow-auto max-h-48",children:[(0,b.jsxs)("h4",{className:"font-mono text-xs text-blue-400 mb-2",children:["Source Raw (",q.length,")"]}),(0,b.jsx)("pre",{className:"text-[10px] text-slate-500 font-mono",children:JSON.stringify(q,null,2)})]}),(0,b.jsxs)("div",{className:"bg-black/40 p-4 rounded-lg border border-slate-800 overflow-auto max-h-48",children:[(0,b.jsxs)("h4",{className:"font-mono text-xs text-amber-400 mb-2",children:["Target Raw (",s.length,")"]}),(0,b.jsx)("pre",{className:"text-[10px] text-slate-500 font-mono",children:JSON.stringify(s,null,2)})]})]})]}),G&&(0,b.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-950/80 backdrop-blur-sm animate-in fade-in duration-300",children:(0,b.jsx)("div",{className:"bg-slate-900 border border-white/10 rounded-2xl shadow-2xl max-w-md w-full p-6 animate-in zoom-in-95 duration-300",children:I?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,b.jsx)("div",{className:"h-16 w-16 rounded-full border-4 border-indigo-500/30 border-t-indigo-500 animate-spin mb-6"}),(0,b.jsx)("h3",{className:"text-xl font-bold text-white mb-2",children:"Requesting Access..."}),(0,b.jsx)("p",{className:"text-slate-400 text-center text-sm",children:"Initiating LCM Provisioning workflow in SailPoint."}),(0,b.jsx)("p",{className:"text-slate-500 text-xs mt-2",children:"This may take a few moments."})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,b.jsx)("div",{className:"p-3 bg-indigo-500/10 rounded-xl text-indigo-400",children:(0,b.jsx)(g,{className:"h-6 w-6"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-white",children:"Confirm Provisioning"}),(0,b.jsx)("p",{className:"text-slate-400 text-sm",children:"Review the access to be added."})]})]}),(0,b.jsxs)("div",{className:"bg-slate-950/50 rounded-xl p-4 mb-6 border border-white/5 max-h-48 overflow-y-auto",children:[(0,b.jsxs)("div",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2",children:["Adding ",G.length," Items to ",o?.userName]}),(0,b.jsx)("div",{className:"space-y-2",children:G.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-300",children:[(0,b.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-indigo-500"}),(0,b.jsx)("span",{className:"truncate",children:a.name})]},c))})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{onClick:()=>H(null),className:"flex-1 py-2.5 rounded-lg border border-white/10 text-sm font-medium text-slate-300 hover:bg-white/5 transition-colors",children:"Cancel"}),(0,b.jsx)("button",{onClick:K,className:"flex-1 py-2.5 rounded-lg bg-indigo-600 text-white text-sm font-bold shadow-lg shadow-indigo-500/20 hover:bg-indigo-500 transition-all",children:"Confirm & Provision"})]})]})})})]})}a.s(["default",()=>k],32735)}];

//# sourceMappingURL=app_compare_page_tsx_01d0c174._.js.map