module.exports=[2624,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(71478),e=a.i(50944),f=a.i(87532),g=a.i(73320),h=a.i(4720),i=a.i(4416),j=a.i(96221),k=a.i(60246);let l=(0,a.i(60137).default)("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var m=a.i(97063);function n(){let{isAuthenticated:a,url:n,username:o,password:p,isLoading:q}=(0,d.useAuth)(),r=(0,e.useRouter)(),[s,t]=(0,c.useState)("auto"),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)({mode:"auto",inactivityAttribute:"lastLogin",authoritativeSource:""}),[C,D]=(0,c.useState)("inactive"),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(null),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)({current:0,total:0,success:0,fail:0}),[S,T]=(0,c.useState)([]),U=async()=>{N(!0),T([]);let a=[];K?.forEach(b=>{b.accessItems?.forEach(c=>{"Entitlement"===c.type?a.push({identity:b.identityName,type:"entitlement",application:c.application,name:c.attribute||"unknown",value:c.value,op:"Remove"}):("Role"===c.type||"Bundle"===c.type)&&a.push({identity:b.identityName,type:"role",name:"assignedRoles",value:c.value,op:"Remove"})})});let b=a.length;if(0===b){T(["No entitlements or roles found to revoke."]),N(!1);return}R({current:0,total:b,success:0,fail:0});let c=new Map;a.forEach(a=>{c.has(a.identity)||c.set(a.identity,[]),c.get(a.identity).push(a)});let d=Array.from(c.entries()),e=0,f=0,g=0,h=0,i=async(a,b)=>{let c=[{key:"identityName",value:a},{key:"accessItems",value:JSON.stringify(b.map(a=>({type:a.type,application:a.application,name:a.name,value:a.value,op:a.op})))}];O||c.push({key:"approvalScheme",value:"none"});try{let d=await fetch("/api/workflow/launch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:n,username:o,password:p,workflowName:"ProvisionAccess",input:c})}),e=await d.json();if(e.success){f+=b.length;let c="N/A";if(e.launchResult&&e.launchResult.attributes){let a=e.launchResult.attributes,b=a.find(a=>"identityRequestId"===a.key);if(b)c=b.value;else{let b=a.find(a=>"plan"===a.key);if(b&&b.value){let a=b.value.match(/key="identityRequestId" value="([^"]+)"/);a&&a[1]&&(c=a[1])}}}T(d=>[`[SUCCESS] ${a}: Revoked ${b.length} items. Request ID: ${c}`,...d].slice(0,50))}else throw Error(e.error||"Unknown error")}catch(c){g+=b.length,T(b=>[`[ERROR] ${a}: ${c.message}`,...b].slice(0,50))}e+=b.length,R(a=>({...a,current:e,success:f,fail:g}))},j=async()=>{for(;h<d.length;){let a=h++;if(a>=d.length)break;let[b,c]=d[a];await i(b,c)}},k=Array(Math.min(3,d.length)).fill(null).map(()=>j());await Promise.all(k),N(!1),T(a=>["[DONE] Batch revocation complete.",...a])};if((0,c.useEffect)(()=>{a&&(async()=>{try{let a=await fetch("/api/leaver/search",{method:"POST",body:JSON.stringify({url:n,username:o,password:p})}),b=await a.json();b.success&&v(b.apps||[]);let c=await fetch("/api/leaver/attributes",{method:"POST",body:JSON.stringify({url:n,username:o,password:p})}),d=await c.json();d.success&&x(d.attributes||[])}catch(a){console.error(a)}})()},[a]),q)return null;if(!a)return r.push("/"),null;let V=async()=>{J(!0),L([]);try{let a={url:n,username:o,password:p,mode:"auto"===s?"scan":"csv",inactiveAttr:C};"auto"===s?a.source=y:a.identityList=G;let b=await fetch("/api/leaver/analyze",{method:"POST",body:JSON.stringify(a)}),c=await b.json();c.success?L(c.report||[]):alert("Analysis failed: "+c.error)}catch(a){alert("Error: "+a.message)}finally{J(!1)}},W=K?K.length:0,X=K?K.reduce((a,b)=>a+(b.accessCount||0),0):0,Y=K?K.filter(a=>"High"===a.riskLevel).length:0;return(0,b.jsxs)("main",{className:"min-h-screen bg-[#020617] text-slate-100 font-sans",children:[(0,b.jsx)("div",{className:"absolute top-0 left-0 w-full h-[400px] bg-gradient-to-b from-cyan-950/20 to-transparent pointer-events-none"}),(0,b.jsxs)("div",{className:"max-w-7xl mx-auto p-8 relative z-10",children:[(0,b.jsx)("div",{className:"mb-8 flex justify-between items-end",children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-4xl font-extrabold bg-gradient-to-r from-white via-cyan-100 to-cyan-400 bg-clip-text text-transparent flex items-center gap-3",children:[(0,b.jsx)(i.ShieldCheck,{className:"h-10 w-10 text-cyan-500"}),"Leaver Access Cleanup"]}),(0,b.jsx)("p",{className:"text-slate-400 mt-2 text-lg",children:"Identify and revoke residual access for inactive identities."})]})}),(0,b.jsxs)("div",{className:"bg-slate-900/40 border border-white/10 rounded-2xl p-6 mb-8 backdrop-blur-xl",children:[(0,b.jsxs)("div",{className:"flex gap-4 border-b border-white/10 pb-4 mb-6",children:[(0,b.jsx)("button",{onClick:()=>t("auto"),className:`px-4 py-2 rounded-lg text-sm font-bold transition-all ${"auto"===s?"bg-cyan-600 text-white":"text-slate-400 hover:text-white"}`,children:"Option A: Automated Fetch"}),(0,b.jsx)("button",{onClick:()=>t("manual"),className:`px-4 py-2 rounded-lg text-sm font-bold transition-all ${"manual"===s?"bg-cyan-600 text-white":"text-slate-400 hover:text-white"}`,children:"Option B: Manual CSV"})]}),(0,b.jsxs)("div",{className:"flex flex-col lg:flex-row gap-8 items-start",children:["auto"===s?(0,b.jsxs)("div",{className:"flex-1 space-y-4 w-full",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-300",children:"Configuration"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:"Authoritative Source (Ignore access)"}),(0,b.jsxs)("select",{value:y,onChange:a=>z(a.target.value),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-cyan-500 outline-none",children:[(0,b.jsx)("option",{value:"",children:"-- Select Source --"}),u.map(a=>(0,b.jsxs)("option",{value:a.name,children:[a.name," ",a.authoritative?"(Auth)":""]},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:"Inactivity Attribute"}),(0,b.jsxs)("select",{value:C,onChange:a=>D(a.target.value),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-cyan-500 outline-none",children:[(0,b.jsx)("option",{value:"inactive",children:"inactive (Default)"}),w.filter(a=>"inactive"!==a).map(a=>(0,b.jsx)("option",{value:a,children:a},a))]})]})]}),(0,b.jsxs)("p",{className:"text-xs text-slate-500",children:["System will scan for users where ",(0,b.jsx)("code",{children:C})," is true/active."]})]}):(0,b.jsxs)("div",{className:"flex-1 space-y-4 w-full",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-300",children:"Configuration"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:"Authoritative Source (Ignore access)"}),(0,b.jsxs)("select",{value:y,onChange:a=>z(a.target.value),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-cyan-500 outline-none",children:[(0,b.jsx)("option",{value:"",children:"-- No Filtering (Show All) --"}),u.map(a=>(0,b.jsxs)("option",{value:a.name,children:[a.name," ",a.authoritative?"(Auth)":""]},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:"Inactivity Attribute"}),(0,b.jsxs)("select",{value:C,onChange:a=>D(a.target.value),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-cyan-500 outline-none",children:[(0,b.jsx)("option",{value:"inactive",children:"inactive (Default)"}),w.filter(a=>"inactive"!==a).map(a=>(0,b.jsx)("option",{value:a,children:a},a))]})]})]}),(0,b.jsxs)("label",{className:"block w-full border-2 border-dashed border-slate-700 rounded-xl p-8 text-center cursor-pointer hover:border-cyan-500/50 hover:bg-cyan-500/5 transition-all",children:[(0,b.jsx)("input",{type:"file",accept:".csv",onChange:a=>{let b=a.target.files?.[0];if(!b)return;F(b);let c=new FileReader;c.onload=a=>{H((a.target?.result).split(/\r?\n/).filter(a=>a.trim().length>0).map(a=>a.split(",")[0].trim()).filter(a=>"identityname"!==a.toLowerCase()))},c.readAsText(b)},className:"hidden"}),(0,b.jsx)(g.Upload,{className:"h-8 w-8 text-cyan-500 mx-auto mb-2"}),(0,b.jsx)("span",{className:"text-slate-300 font-medium",children:"Click to Upload CSV"}),(0,b.jsx)("span",{className:"block text-xs text-slate-500 mt-1",children:E?E.name:"Drag & Drop Identity List"})]}),G.length>0&&(0,b.jsxs)("p",{className:"text-xs text-emerald-400",children:[G.length," identities loaded."]})]}),(0,b.jsxs)("button",{onClick:V,disabled:I||"auto"===s&&!y||"manual"===s&&!E,className:"h-[80px] px-8 rounded-xl bg-gradient-to-br from-cyan-600 to-blue-700 hover:from-cyan-500 hover:to-blue-600 text-white font-bold shadow-lg shadow-cyan-900/20 disabled:opacity-50 disabled:cursor-not-allowed flex flex-col items-center justify-center gap-1 min-w-[200px]",children:[I?(0,b.jsx)(j.Loader2,{className:"h-6 w-6 animate-spin"}):(0,b.jsx)(f.Search,{className:"h-6 w-6"}),(0,b.jsx)("span",{children:I?"Analyzing...":"Scan & Analyze"})]})]})]}),K&&(0,b.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-8 duration-500",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"bg-slate-900/60 border border-white/5 p-6 rounded-2xl flex items-center gap-4",children:[(0,b.jsx)("div",{className:"p-3 bg-blue-500/10 rounded-full text-blue-400",children:(0,b.jsx)(k.Users,{className:"h-6 w-6"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-slate-400 text-xs uppercase tracking-wider",children:"Identities Found"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-white",children:W})]})]}),(0,b.jsxs)("div",{className:"bg-slate-900/60 border border-white/5 p-6 rounded-2xl flex items-center gap-4",children:[(0,b.jsx)("div",{className:"p-3 bg-purple-500/10 rounded-full text-purple-400",children:(0,b.jsx)(h.FileText,{className:"h-6 w-6"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-slate-400 text-xs uppercase tracking-wider",children:"Items to Revoke"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-white",children:X})]})]}),(0,b.jsxs)("div",{className:"bg-slate-900/60 border border-white/5 p-6 rounded-2xl flex items-center gap-4",children:[(0,b.jsx)("div",{className:"p-3 bg-amber-500/10 rounded-full text-amber-400",children:(0,b.jsx)(m.Info,{className:"h-6 w-6"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-slate-400 text-xs uppercase tracking-wider",children:"High Risk"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-white",children:Y})]})]})]}),(0,b.jsxs)("div",{className:"bg-slate-900/40 border border-white/10 rounded-2xl overflow-hidden",children:[(0,b.jsxs)("div",{className:"p-4 bg-white/5 flex justify-between items-center",children:[(0,b.jsx)("h3",{className:"font-bold text-lg",children:"Candidates for Revocation"}),(0,b.jsx)("span",{className:"text-xs text-slate-400",children:"Review carefully before executing"})]}),(0,b.jsx)("div",{className:"overflow-auto max-h-[500px]",children:(0,b.jsxs)("table",{className:"w-full text-left text-sm text-slate-400",children:[(0,b.jsx)("thead",{className:"bg-slate-950 text-xs uppercase font-medium text-slate-500 sticky top-0",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-4",children:"UserName"}),(0,b.jsx)("th",{className:"px-6 py-4",children:"Inactive"}),(0,b.jsx)("th",{className:"px-6 py-4",children:"Applications"}),(0,b.jsx)("th",{className:"px-6 py-4",children:"Entitlements still has access to"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-white/5",children:K.map((a,c)=>{let d=Array.from(new Set(a.accessItems?.map(a=>a.application)||[])).filter(Boolean);return(0,b.jsxs)("tr",{className:"hover:bg-white/5 transition-colors group",children:[(0,b.jsxs)("td",{className:"px-6 py-3 font-medium text-white align-top",children:[a.identityName,a.employeeId&&(0,b.jsxs)("span",{className:"block text-xs text-slate-600 font-normal",children:["ID: ",a.employeeId]})]}),(0,b.jsx)("td",{className:"px-6 py-3 align-top",children:(0,b.jsx)("span",{className:"px-2 py-1 rounded text-xs bg-emerald-500/10 text-emerald-400 font-mono",children:"true"})}),(0,b.jsx)("td",{className:"px-6 py-3 align-top",children:(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:d.length>0?d.map((a,c)=>(0,b.jsx)("span",{className:"px-2 py-0.5 rounded-md bg-slate-800 border border-slate-700 text-xs text-white",children:a},c)):(0,b.jsx)("span",{className:"text-slate-600",children:"-"})})}),(0,b.jsx)("td",{className:"px-6 py-3 align-top",children:(0,b.jsx)("div",{className:"space-y-1 max-h-[100px] overflow-y-auto pr-2 custom-scrollbar",children:a.accessItems&&a.accessItems.length>0?a.accessItems.map((a,c)=>(0,b.jsxs)("div",{className:"text-xs text-slate-300",children:[a.name||a.value," ",(0,b.jsxs)("span",{className:"text-slate-600",children:["(",a.application,")"]})]},c)):(0,b.jsx)("span",{className:"text-slate-600",children:"No residual access found"})})})]},c)})})]})})]}),(0,b.jsxs)("div",{className:"flex flex-col md:flex-row justify-between p-6 bg-slate-900/60 rounded-2xl border border-white/10 items-center gap-6",children:[(0,b.jsxs)("div",{className:"text-left w-full md:w-auto",children:[(0,b.jsx)("p",{className:"text-white font-bold text-lg",children:"Download Revocation Files"}),(0,b.jsx)("p",{className:"text-slate-400 text-sm",children:"Generate CSVs for bulk processing."})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-3 w-full md:w-auto justify-end",children:[(0,b.jsxs)("button",{onClick:()=>{let a=[];K.forEach(b=>{b.accessItems?.forEach(c=>{"Role"===c.type&&a.push(["removeRole",c.name,b.identityName])})});let b=new Blob([["operation,roles,identityName",...a.map(a=>a.join(","))].join("\n")],{type:"text/csv"}),c=window.URL.createObjectURL(b),d=document.createElement("a");d.href=c,d.download=`remove_roles_${new Date().getTime()}.csv`,d.click()},disabled:0===W,className:"px-4 py-3 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-lg transition-all flex items-center gap-2",children:[(0,b.jsx)(h.FileText,{className:"h-4 w-4"})," Roles CSV"]}),(0,b.jsxs)("button",{onClick:()=>{let a=[];K.forEach(b=>{b.accessItems?.forEach(c=>{"Entitlement"===c.type&&a.push(["removeEntitlement",c.application,c.attribute||"unknown",c.value,b.identityName])})});let b=new Blob([["operation,application,attributeName,attributeValue,identityName",...a.map(a=>a.join(","))].join("\n")],{type:"text/csv"}),c=window.URL.createObjectURL(b),d=document.createElement("a");d.href=c,d.download=`remove_entitlements_${new Date().getTime()}.csv`,d.click()},disabled:0===W,className:"px-4 py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg transition-all flex items-center gap-2",children:[(0,b.jsx)(h.FileText,{className:"h-4 w-4"})," Entitlements CSV"]}),(0,b.jsxs)("button",{onClick:()=>{let a=[];K.forEach(b=>{b.accessItems?.forEach(c=>{"Account"===c.type&&a.push(["DisableAccount",c.application,b.identityName])})});let b=new Blob([["operation,application,identityName",...a.map(a=>a.join(","))].join("\n")],{type:"text/csv"}),c=window.URL.createObjectURL(b),d=document.createElement("a");d.href=c,d.download=`disable_accounts_${new Date().getTime()}.csv`,d.click()},disabled:0===W,className:"px-4 py-3 bg-slate-700 hover:bg-slate-600 text-white font-bold rounded-lg transition-all flex items-center gap-2",children:[(0,b.jsx)(h.FileText,{className:"h-4 w-4"})," Disable Accounts CSV"]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col p-6 bg-slate-900/60 rounded-2xl border border-white/10 gap-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xl font-extrabold bg-gradient-to-r from-cyan-400 to-blue-300 bg-clip-text text-transparent",children:"Direct Revocation"}),(0,b.jsx)("p",{className:"text-slate-400 text-sm",children:"Execute provisioning requests directly from this report."})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-slate-800/50 border border-white/5 px-3 py-2 rounded-lg",children:[(0,b.jsx)("input",{type:"checkbox",checked:O,onChange:a=>P(a.target.checked),className:"h-4 w-4 rounded border-slate-600 bg-slate-700 text-cyan-500 focus:ring-cyan-500/50"}),(0,b.jsx)("label",{className:"text-xs font-medium text-slate-300",children:"Create Workitems"})]}),(0,b.jsxs)("button",{onClick:U,disabled:M||0===W,className:`px-6 py-3 rounded-xl font-bold uppercase text-xs tracking-wider transition-all flex items-center gap-2 ${M||0===W?"bg-slate-800 text-slate-500 cursor-not-allowed":"bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white shadow-lg shadow-cyan-900/20"}`,children:[M?(0,b.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(l,{className:"h-4 w-4"}),M?"Revoking...":"Execute Revocation"]})]})]}),(M||Q.total>0)&&(0,b.jsxs)("div",{className:"space-y-4 animate-in fade-in duration-300",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-slate-300 font-medium",children:["Batch Progress: ",(0,b.jsx)("span",{className:"text-white",children:Q.current})," / ",Q.total," requests"]}),(0,b.jsxs)("span",{className:"text-cyan-400 font-bold",children:[Math.round(Q.total>0?Q.current/Q.total*100:0),"%"]})]}),(0,b.jsx)("div",{className:"w-full bg-slate-800 rounded-full h-3 overflow-hidden shadow-inner border border-slate-700",children:(0,b.jsx)("div",{className:"bg-gradient-to-r from-cyan-500 to-blue-600 h-full rounded-full transition-all duration-300 ease-out shadow-[0_0_10px_rgba(6,182,212,0.5)]",style:{width:`${Q.total>0?Q.current/Q.total*100:0}%`}})}),(0,b.jsxs)("div",{className:"bg-black/40 border border-white/10 rounded-xl p-4 h-[200px] flex flex-col",children:[(0,b.jsx)("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-3",children:"Execution Logs"}),(0,b.jsxs)("div",{className:"flex-1 overflow-auto space-y-2 custom-scrollbar font-mono text-xs",children:[0===S.length&&(0,b.jsx)("span",{className:"text-slate-600 italic",children:"Waiting..."}),S.map((a,c)=>(0,b.jsx)("div",{className:`p-2 rounded border ${a.includes("[SUCCESS]")?"bg-emerald-500/10 border-emerald-500/20 text-emerald-400":"bg-red-500/10 border-red-500/20 text-red-400"}`,children:a},c))]})]})]})]})]})]})]})}a.s(["default",()=>n],2624)}];

//# sourceMappingURL=app_leaver-cleanup_page_tsx_685f5ec3._.js.map